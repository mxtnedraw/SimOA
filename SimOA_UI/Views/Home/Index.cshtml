@model List<SimOA_UI.Models.MenuViewModel>
@{
    Layout = null;
}
@using SimOA_UI.Models;
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>首页-易OA</title>
    <link href="~/Content/Ligerui/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.7.1.min.js"></script>
    <script src="~/Content/Ligerui/ligerUI/js/core/base.js"></script>
    <script src="~/Content/Ligerui/ligerUI/js/plugins/ligerDrag.js"></script>
    <script src="~/Content/Ligerui/ligerUI/js/plugins/ligerDialog.js"></script>
    <script src="~/Content/Ligerui/ligerUI/js/plugins/ligerResizable.js"></script>
    <script src="~/Content/Ligerui/ligerUI/js/plugins/ligerPanel.js"></script>
    <style type="text/css">
        .l-case-title {
            font-weight: bold;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        body, html {
            width: 100%;
            height: 100%;
        }

        * {
            margin: 0;
            padding: 0;
        }

        #winlinks {
            position: absolute;
            left: 20px;
            top: 80px;
            width: 100%;
        }

            #winlinks ul {
                position: relative;
            }

            #winlinks li {
                width: 70px;
                cursor: pointer;
                height: 80px;
                position: absolute;
                z-index: 101;
                list-style: none;
                text-align: center;
            }

                #winlinks li img {
                    width: 36px;
                    height: 36px;
                }

                #winlinks li span {
                    background: none repeat scroll 0 0 rgba(0, 0, 0, 0.3);
                    border-radius: 10px 10px 10px 10px;
                    display: block;
                    font-size: 12px;
                    margin-top: 1px;
                    color: White;
                    line-height: 18px;
                    text-align: center;
                }

                #winlinks li.l-over div.bg {
                    display: block;
                }

                #winlinks li div.bg {
                    display: none;
                    position: absolute;
                    top: -2px;
                    left: -2px;
                    z-index: 0;
                    width: 75px;
                    height: 64px;
                    -webkit-border-radius: 5px;
                    -moz-border-radius: 5px;
                    border-radius: 5px;
                    background: #000;
                    opacity: 0.1;
                    filter: alpha(opacity=10);
                }

        .l-taskbar-task-icon {
            top: 3px;
            left: 6px;
            background-image: none;
        }

        .l-taskbar-task-content {
            margin-left: 30px;
        }

        .l-taskbar-task-icon img {
            width: 22px;
            height: 22px;
        }

        #simtools {
            position: absolute;
            width: 248px;
            height: 460px;
            top: 160px;
            right: 0px;
        }

        #toptip {
            position: relative;
            height: 60px;
            font: bold 30px '.PingFang SC','楷体','仿宋';
            color: #40baba;
            border-bottom: 1px solid #808080;
        }

        .box {
            width: 400px;
            height: 400px;
            border: 10px solid #8bf2f1;
            margin: 30px auto;
            border-radius: 50%;
            box-shadow: 0px 0px 20px 3px #444 inset;
            position: relative;
            zoom: 0.5;
            -moz-transform:scale(0.5);
			-moz-transform-origin:top left;
            background-color:rgba(255,255,255,0.8)
        }
        /*原点*/
        .origin {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #c0c0c0;
            top: 190px;
            left: 190px;
            position: absolute;
        }
        /* 指针 */
        .clock_line {
            position: absolute;
            position: absolute;
            z-index: 20;
        }

        .hour_line {
            width: 100px;
            height: 4px;
            top: 198px;
            left: 200px;
            background-color: #000;
            border-radius: 2px;
            transform-origin: 0 50%;
            box-shadow: 1px -1px 8px 1px #1F4871;
        }

        .minute_line {
            width: 130px;
            height: 2px;
            top: 199px;
            left: 190px;
            background-color: #000;
            transform-origin: 7.692% 50%;
            box-shadow: 1px -3px 8px 1px #1F4871;
        }

        .second_line {
            width: 170px;
            height: 1px;
            top: 199.5px;
            left: 180px;
            background-color: #f60;
            transform-origin: 11.765% 50%;
            box-shadow: 1px -3px 7px 1px #1F4871;
        }

        .dot_box {
            width: inherit;
            height: inherit;
        }
        /*时钟数*/
        .dot {
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            font-size: 22px;
            position: absolute;
        }

        .clock-scale {
            width: 195px;
            height: 2px;
            transform-origin: 0% 50%;
            z-index: 7;
            position: absolute;
            top: 199px;
            left: 200px;
        }

        .scale-show {
            width: 12px;
            height: 2px;
            background-color: #111;
            float: left;
        }

        .scale-hidden {
            width: 183px;
            height: 2px;
            float: left;
        }
        /*日期*/
        .date_info {
            width: 180px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            position: absolute;
            top: 230px;
            left: 120px;
            z-index: 11;
            color: #111;
            font-weight: bold;
            font-size: 24px;
        }

        .time_info {
            width: 110px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            position: absolute;
            top: 290px;
            left: 150px;
            z-index: 11;
            color: #555;
            background: #253e3e;
        }

        .time {
            width: 35px;
            height: 35px;
            float: left;
            color: #fff;
            font-size: 22px;
        }

        #minute_time {
            border-left: 1px solid #aaa;
            border-right: 1px solid #aaa;
        }

        #quickEntry {
            overflow: hidden;
        }

        .rightAlign {
            position:relative;
            left:150px;
            text-decoration:none;
        }
        #quickEntry span {
            margin-left:5px;
        }
        .panelHead {
            background:hsla(0,0%,100%,.7);
            font-size:14px;
        }
        .panelContent {
            background:hsla(0,0%,100%,.3);
            font-size:12px;
            overflow-y:auto;
            padding:5px 0 0 3px;
        }
    </style>
</head>
<body style="overflow: hidden; background: url(/Content/Images/1.jpg) no-repeat  center center;">
    <div id="toptip">
        <div style="text-align: center;">
            <span style="line-height: 60px; letter-spacing: 10px;">易OA,简易不简单</span>
        </div>
        <span style="line-height: 100px; position: absolute; right: 30px; top: 0; font-size: 16px; color: #b5780a;">@ViewBag.CurrentUser,欢迎你</span>
    </div>
    <div id="winlinks">
        <ul>
        </ul>
    </div>
    <div id="simtools">
        <div style="text-align: center; clear: both;">
        </div>
        <div class="box" id="clock">
            <!-- 原点 -->
            <div class="origin"></div>
            <!-- 时钟数 -->
            <div class="dot_box">
                <div class="dot">6</div>
                <div class="dot">5</div>
                <div class="dot">4</div>
                <div class="dot">3</div>
                <div class="dot">2</div>
                <div class="dot">1</div>
                <div class="dot">12</div>
                <div class="dot">11</div>
                <div class="dot">10</div>
                <div class="dot">9</div>
                <div class="dot">8</div>
                <div class="dot">7</div>
            </div>
            <!-- 时、分、秒针 -->
            <div class="clock_line hour_line" id="hour_line"></div>
            <div class="clock_line minute_line" id="minute_line"></div>
            <div class="clock_line second_line" id="second_line"></div>
            <!-- 日期 -->
            <div class="date_info" id="date_info"></div>
            <!-- 时间 -->
            <div class="time_info">
                <div class="time" id="hour_time"></div>
                <div class="time" id="minute_time"></div>
                <div class="time" id="second_time"></div>
            </div>
        </div>
        <div id="quickEntry">
            <ul>
                @{
                    List<QuickEntryViewModel> ltEntry = ViewData["Entry"] as List<QuickEntryViewModel>;
                    int i = 1;
                    foreach (var item in ltEntry)
                    {  
                        if (item.InstanceState == 1)
                        {
                            <li style="position:relative;">@(i++).<span>@item.InstanceTitle</span><span>驳回人:@item.SubBy</span><br /><a href="javascript:void(0);" class="rightAlign" id="aReject@(i)">被驳回&nbsp;&nbsp;查看</a></li>
                        }
                        else
                        {
                            <li style="position:relative;">@(i++).<span>@item.InstanceTitle</span><span>申请人:@item.SubBy</span><br /><a href="javascript:void(0);" class="rightAlign" id="aApprove@(i)">待审批&nbsp;&nbsp;查看</a></li>
                        }
                    }
                }
            </ul>
        </div>
    </div>
</body>
<script type="text/javascript">
    var LINKWIDTH = 90, LINKHEIGHT = 90, TASKBARHEIGHT = 43;
    var winlinksul = $("#winlinks ul");
    function f_open(url, title, icon) {
        var isPersonal = url == "/UserInfo/PersonalInfo" || url == "/UserInfo/PasswordEdit";
        var isHandle = url == "/WorkFlow" || url == "/WorkFlow/ApproveList";
        var winHeight = isPersonal ? 450 : 620;
        var winWidth = isPersonal ? 550 : 750;
        var win = $.ligerDialog.open(
        {
            height: winHeight, url: url, width: winWidth, showMax: true, showToggle: true, showMin: true, isResize: true, modal: false, title: title, slide: false, buttons: [
              {
                  text: '确定', onclick: function (item, Dialog, index) {
                      if (isPersonal) {
                          win.jiframe[0].contentWindow.subForm();
                      }
                      win.hide();
                      if (isHandle) {
                          location.reload();
                      }
                  }
              }
            ]
        });
        var task = jQuery.ligerui.win.tasks[win.id];
        if (task) {
            $(".l-taskbar-task-icon:first", task).html('<img src="' + icon + '" />');
        }
        return win;
    }

    function logout(url) {
        $.post(url, "", function (data) {
            if (data == "ok") {
                location.href = '@Url.Action("Index", "Login")';
        }
        });
    }
    function afterPersonal(data) {
        if (data == "ok") {
            $.ligerDialog.tip({ title: '提示信息', content: '更新成功！' });
        } else {
            $.ligerDialog.error('更新信息失败，请稍候重试!');
        }
    }
    function afterPwdEdit(data) {
        if (data == "ok") {
            $.ligerDialog.tip({ title: '提示信息', content: '密码修改成功！' });
        } else {
            $.ligerDialog.error('密码修改失败，请稍候重试!');
        }
    }
var links = [
        @foreach (var item in Model)
        {
  @Html.Raw("{ icon: '" + item.MenuIcon + "', title: '" + item.ActionTitle + "', url: '" + Url.Action(item.ActionName, item.ControllerName) + "' },")
        }
            { icon: '/Content/Images/big.png', title: '注销', url: '@Url.Action("Logout", "Login")' }

];

function onResize() {
    var linksHeight = $(window).height() - TASKBARHEIGHT - 60;
    var winlinks = $("#winlinks");
    winlinks.height(linksHeight);
    var colMaxNumber = parseInt(linksHeight / LINKHEIGHT);//一列最多显示几个快捷方式

    for (var i = 0, l = links.length; i < l; i++) {
        var link = links[i];
        var jlink = $("li[linkindex=" + i + "]", winlinks);
        if (i == l - 1) {
            jlink.css({ top: 0, right: "30px" });
        } else {
            var top = (i % colMaxNumber) * LINKHEIGHT, left = parseInt(i / colMaxNumber) * LINKWIDTH;
            if (isNaN(top) || isNaN(left)) continue;
            jlink.css({ top: top, left: left });
        }

    }

}
function linksInit() {
    for (var i = 0, l = links.length; i < l; i++) {
        var link = links[i];
        var jlink;
        var jlink = $("<li></li>");
        jlink.attr("linkindex", i);
        jlink.append("<img src='" + link.icon + "' />");
        jlink.append("<span>" + link.title + "</span>");
        jlink.append("<div class='bg'></div>");
        jlink.hover(function () {
            $(this).addClass("l-over");
        }, function () {
            $(this).removeClass("l-over");
        }).click(function () {
            var linkindex = $(this).attr("linkindex");
            var link = links[linkindex];
            if (linkindex == l - 1) {
                logout(link.url);
            } else {
                f_open(link.url, link.title, link.icon);
            }

        });
        jlink.appendTo(winlinksul);
    }

}

$(window).resize(onResize);
$.ligerui.win.removeTaskbar = function () { }; //不允许移除
$.ligerui.win.createTaskbar(); //页面加载时创建任务栏

linksInit();
onResize();
    
function savePersonalInfo() {

}

$(function () {
    var clock = document.getElementById("clock");
    function initNumXY() {
        // 1、12个数字的位置设置
        var radius = 160;//大圆半价
        var dot_num = 360 / $(".dot").length;//每个div对应的弧度数
        //每一个dot对应的弧度;
        var ahd = dot_num * Math.PI / 180;
        $(".dot").each(function (index, el) {
            $(this).css({
                "left": 180 + Math.sin((ahd * index)) * radius,
                "top": 180 + Math.cos((ahd * index)) * radius
            });
        });
        // 2、刻钟设置
        for (var i = 0; i < 60; i++) {
            clock.innerHTML += "<div class='clock-scale'> " +
                   "<div class='scale-hidden'></div>" +
                   "<div class='scale-show'></div>" +
                  "</div>";
        }
        var scale = document.getElementsByClassName("clock-scale");
        for (var i = 0; i < scale.length; i++) {
            scale[i].style.transform = "rotate(" + (i * 6 - 90) + "deg)";
        }
    }
    initNumXY();//调用上面的函数
    //获取时钟id
    var hour_line = document.getElementById("hour_line"),
        minute_line = document.getElementById("minute_line"),
        second_line = document.getElementById("second_line"),
        date_info = document.getElementById("date_info"),//获取date_info
        hour_time = document.getElementById("hour_time"),// 获去时间id
        minute_time = document.getElementById("minute_time"),
        second_time = document.getElementById("second_time");
    //3、设置动态时间
    function setTime() {
        var nowdate = new Date();
        //获取年月日时分秒
        var year = nowdate.getFullYear(),
            month = nowdate.getMonth() + 1,
            day = nowdate.getDay(),
            hours = nowdate.getHours(),
            minutes = nowdate.getMinutes(),
            seconds = nowdate.getSeconds(),
            date = nowdate.getDate();
        var weekday = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
        // 获取日期id
        date_info.innerHTML = year + "年" + month + "月" + date + "日   " + weekday[day];
        hour_time.innerHTML = hours >= 10 ? hours : "0" + hours;
        minute_time.innerHTML = minutes >= 10 ? minutes : "0" + minutes;
        second_time.innerHTML = seconds >= 10 ? seconds : "0" + seconds;
        //console.log(year + "年" + month + "月" + date + "日   " + weekday[day]);
        //时分秒针设置
        var hour_rotate = (hours * 30 - 90) + (Math.floor(minutes / 12) * 6);
        hour_line.style.transform = 'rotate(' + hour_rotate + 'deg)';
        minute_line.style.transform = 'rotate(' + (minutes * 6 - 90) + 'deg)';
        second_line.style.transform = 'rotate(' + (seconds * 6 - 90) + 'deg)';
    }
    // setTime();
    setInterval(setTime, 1000);

    $("#quickEntry").ligerPanel({
        title: '待办事项',
        width: 240,
        height: 220
    });
    $(".l-panel-header").addClass("panelHead");
    $(".l-panel-content").addClass("panelContent");

    $("a[id^='aReject']").click(function () {
        f_open('@Url.Action("Index","WorkFlow")', "流程管理", "");
    });
    $("a[id^='aApprove']").click(function () {
        f_open('@Url.Action("ApproveList","WorkFlow")', "审批管理", "");
    });
    if ($("#quickEntry li").length == 0) {
        $("#quickEntry").hide();
    }


});
</script>
</html>
